<!DOCTYPE html>
<html lang="bs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EKO AI FARMA 7.0 â€” Glavna Stanica</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>

<body class="pozadina">
<header>
  <h1>ğŸŒ¾ EKO AI FARMA 7.0</h1>
  <p>Digitalni agronom â€” AI nadzor, dron analiza i glasovni asistent</p>
</header>

<nav>
  <a href="index.html">ğŸ¡ PoÄetna</a>
  <a href="mapa.html">ğŸ—º Mapa</a>
</nav>

<main>
  <section>
  <h2>â˜˜ Vizuelna analiza drona</h2>

  <div id="aiMonitor" class="ai-monitor"></div>

  <button onclick="toggleGlas()" id="glasBtn">ğŸ”Š UkljuÄi glasovni nadzor</button>

  <script>
  let glasAktivan = false;
  const monitor = document.getElementById("aiMonitor");
  const dugme = document.getElementById("glasBtn");

  function generisiPoruku() {
    const sada = new Date();
    const vrijeme = sada.toLocaleTimeString("bs-BA");
    const datum = sada.toLocaleDateString("bs-BA");

    const temperatura = (15 + Math.random() * 10).toFixed(1);
    const vlaga = (50 + Math.random() * 40).toFixed(1);
    const co2 = (350 + Math.random() * 150).toFixed(0);
    const bakterije = ["niska", "normalna", "poviÅ¡ena", "kritiÄna"][Math.floor(Math.random() * 4)];

    const poruke = [
      `ğŸ“… Datum: ${datum} | ğŸ•“ Vrijeme: ${vrijeme}`,
      `ğŸŒ¡ Temperatura tla: ${temperatura}Â°C`,
      `ğŸ’§ VlaÅ¾nost zraka: ${vlaga}%`,
      `ğŸ’¨ COâ‚‚ koncentracija: ${co2} ppm`,
      `ğŸ¦  Aktivnost bakterija: ${bakterije}`,
      bakterije === "kritiÄna"
        ? "âš ï¸ Upozorenje: otkrivene su anomalije u zemljiÅ¡tu!"
        : "âœ… Sistem stabilan. Analiza u toku..."
    ];

    // Ispis poruka
    monitor.innerHTML = poruke.map(p => `<p>${p}</p>`).join("");

    // Glasovni izlaz
    if (glasAktivan) {
      let tekstZaCitanje = `Trenutno vrijeme ${vrijeme}. Temperatura tla ${temperatura} stepeni. VlaÅ¾nost ${vlaga} posto. COâ‚‚ koncentracija ${co2} ppm. Aktivnost bakterija je ${bakterije}.`;
      if (bakterije === "kritiÄna") {
        tekstZaCitanje += " Upozorenje! Potrebna je hitna provjera tla!";
      }
      govoriAI(tekstZaCitanje);
    }
  }

  // Funkcija za govor
  function govoriAI(tekst) {
    const msg = new SpeechSynthesisUtterance(tekst + " Potpisuje Elvir AI sistem nadzora.");
    msg.lang = "bs-BA";
    msg.pitch = 0.9;
    msg.rate = 0.95;
    msg.volume = 1;
    window.speechSynthesis.cancel(); // prekini prethodni govor
    window.speechSynthesis.speak(msg);
  }

  function toggleGlas() {
    glasAktivan = !glasAktivan;
    dugme.textContent = glasAktivan ? "ğŸ”‡ IskljuÄi glasovni nadzor" : "ğŸ”Š UkljuÄi glasovni nadzor";
    if (glasAktivan) govoriAI("Glasovni nadzor aktiviran. Sistem poÄinje s analizom.");
  }

  generisiPoruku();
  setInterval(generisiPoruku, 4000);
  </script>
</section>


  <section>
    <h2>ğŸ“Š AI senzori i prognoza</h2>
    <div id="vrijeme">UÄitavanje meteo podataka...</div>
    <canvas id="graf"></canvas>
    <canvas id="prognozaGraf"></canvas>
    <button onclick="pokreni()">â–¶ Start</button>
    <button onclick="pauziraj()">â¸ Pauza</button>
    <button onclick="spremiPDF()">ğŸ“„ PDF IzvjeÅ¡taj</button>
  </section>

  <section id="chatAI">
    <h2>ğŸ§  Glasovni asistent â€” Elvir AI</h2>
    <div id="chatOkvir" style="background:#101b10;padding:15px;border-radius:10px;height:180px;overflow-y:auto;border:1px solid #d4af37;"></div>
    <input id="unosChat" placeholder="Postavi pitanje (npr. kakva je vlaga?)" onkeypress="if(event.key==='Enter')posaljiPoruku()">
    <button onclick="zapocniSlusanje()">ğŸ™ Govori</button>
  </section>
</main>

<footer>
  Â© 2025 â€” <b>AI Asistent: Elvir ÄŒajiÄ‡</b> | Eko AI Laboratorija Poljoprivrede
</footer>

<script>
// --- GLOBALNE VARIJABLE ---
let aktivno=false, interval, chart, progChart;
let dataTemp=[], dataVlaga=[], timestamps=[];
const synth=window.speechSynthesis;

// --- UÄitavanje trenutnog vremena ---
async function ucitajVrijeme(){
  try{
    const res=await fetch("https://api.open-meteo.com/v1/forecast?latitude=44.53&longitude=18.67&current_weather=true");
    const p=await res.json();
    const temp=p.current_weather.temperature;
    document.getElementById("vrijeme").innerHTML=`ğŸŒ¤ Trenutna temperatura: ${temp}Â°C | Lokacija: Lukavac`;
  }catch{
    document.getElementById("vrijeme").textContent="âš  GreÅ¡ka pri uÄitavanju vremenskih podataka.";
  }
}
ucitajVrijeme();

// --- Simulacija podataka ---
function pokreni(){
  if(aktivno)return;
  aktivno=true;
  interval=setInterval(()=>{
    const t=(Math.random()*8+16).toFixed(1);
    const v=(Math.random()*35+40).toFixed(1);
    timestamps.push(new Date().toLocaleTimeString("bs-BA"));
    if(timestamps.length>15){timestamps.shift();dataTemp.shift();dataVlaga.shift();}
    dataTemp.push(t);dataVlaga.push(v);
    azurirajGraf();azurirajPrognozu();
  },2000);
}
function pauziraj(){aktivno=false;clearInterval(interval);}

// --- Grafovi ---
function azurirajGraf(){
  const ctx=document.getElementById("graf").getContext("2d");
  if(chart)chart.destroy();
  chart=new Chart(ctx,{
    type:"line",
    data:{labels:timestamps,
    datasets:[
      {label:"ğŸŒ¡ Temperatura (Â°C)",data:dataTemp,borderColor:"#ffd700",fill:false},
      {label:"ğŸ’§ VlaÅ¾nost (%)",data:dataVlaga,borderColor:"#1aff1a",fill:false}
    ]}});
}
function azurirajPrognozu(){
  const ctx=document.getElementById("prognozaGraf").getContext("2d");
  if(progChart)progChart.destroy();
  const avg=dataVlaga.reduce((a,b)=>+a+ +b,0)/dataVlaga.length||0;
  const prog=Math.min(100,avg+Math.random()*5);
  progChart=new Chart(ctx,{
    type:"bar",
    data:{labels:["PredviÄ‘eni prinos (%)"],datasets:[{data:[prog],backgroundColor:"#c9a227"}]}});
}

// --- Glasovni AI ---
let prepoznaj;
if("webkitSpeechRecognition" in window){
  prepoznaj=new webkitSpeechRecognition();
  prepoznaj.lang="bs-BA";
  prepoznaj.continuous=false;
  prepoznaj.interimResults=false;
  prepoznaj.onresult=(e)=>{
    const tekst=e.results[0][0].transcript;
    dodajPoruku("ğŸ™ Ti: "+tekst);
    odgovoriAI(tekst);
  };
}

function zapocniSlusanje(){
  if(!prepoznaj){alert("Tvoj pretraÅ¾ivaÄ ne podrÅ¾ava glasovni unos.");return;}
  prepoznaj.start();
  dodajPoruku("ğŸ§  Elvir AI: SluÅ¡am paÅ¾ljivo...");
}

function posaljiPoruku(){
  const unos=document.getElementById("unosChat");
  const tekst=unos.value.trim();
  if(!tekst)return;
  dodajPoruku("ğŸ‘¨â€ğŸŒ¾ Ti: "+tekst);
  unos.value="";
  odgovoriAI(tekst);
}

function dodajPoruku(txt){
  const chat=document.getElementById("chatOkvir");
  const p=document.createElement("p");
  p.textContent=txt;
  chat.appendChild(p);
  chat.scrollTop=chat.scrollHeight;
}

// --- AI odgovori i â€œbaza porukaâ€ ---
const porukeBaza=[
  "Vlaga je stabilna, rast biljaka u optimalnom intervalu.",
  "Temperatura u plasteniku je u granicama normale.",
  "AI predviÄ‘a porast prinosa za 13.2%.",
  "Dron je aktivan i snima sektor A2.",
  "UoÄena poveÄ‡ana bakterijska aktivnost â€“ provjeriti tlo.",
  "COâ‚‚ vrijednosti su blago poviÅ¡ene, preporuÄujem ventilaciju.",
  "Sistem je u potpunosti operativan i stabilan.",
  "Zdravo, ovdje Elvir AI â€” tvoj digitalni agronom."
];

function odgovoriAI(tekst){
  let odgovor="";
  const unos=tekst.toLowerCase();
  if(unos.includes("temperatura")) odgovor=porukeBaza[1];
  else if(unos.includes("vlaga")) odgovor=porukeBaza[0];
  else if(unos.includes("bakterije")) odgovor=porukeBaza[4];
  else if(unos.includes("co2")) odgovor=porukeBaza[5];
  else if(unos.includes("sistem")) odgovor=porukeBaza[6];
  else if(unos.includes("dron")) odgovor=porukeBaza[3];
  else odgovor=porukeBaza[Math.floor(Math.random()*porukeBaza.length)];
  dodajPoruku("ğŸ§  Elvir AI: "+odgovor);
  govoriAI(odgovor);
}

// --- Glasovno izgovaranje ---
function govoriAI(tekst){
  const glas=new SpeechSynthesisUtterance(tekst+" â€” potpisuje Elvir AI asistent.");
  glas.lang="bs-BA";
  glas.pitch=0.9;
  glas.rate=0.92;
  glas.volume=1;
  speechSynthesis.speak(glas);
}

// --- PDF IzvjeÅ¡taj ---
function spremiPDF(){
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF();
  doc.text("EKO AI IzvjeÅ¡taj â€” Digitalni Agronom",10,15);
  doc.text("Autor: AI Asistent Elvir ÄŒajiÄ‡",10,25);
  dataTemp.forEach((t,i)=>{
    doc.text(`${timestamps[i]} â€” Temp: ${t}Â°C, Vlaga: ${dataVlaga[i]}%`,10,40+i*7);
  });
  doc.save("EkoAI_izvjestaj.pdf");
}

// --- Automatski AI izvjeÅ¡taji svakih 15 sekundi ---
setInterval(()=>{
  const poruka=porukeBaza[Math.floor(Math.random()*porukeBaza.length)];
  dodajPoruku("ğŸ§  Elvir AI (auto-izvjeÅ¡taj): "+poruka);
  govoriAI(poruka);
},15000);
</script>

</body>
</html>
