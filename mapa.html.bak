<!DOCTYPE html>
<html lang="bs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ—º AI GeoHub â€” Mapa Dron Letova</title>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
</head>
<body class="pozadina">

<header>
  <h1>ğŸ›° AI Mapa Letova Drona</h1>
  <p>Real-time koordinacije, senzori i analiza sa EKO AI FARME</p>
</header>

<nav>
  <a href="index.html">ğŸ  PoÄetna</a>
  <a href="galerija.html">ğŸ“Š Nadzorna stanica</a>
  <a href="mapa.html" class="aktivno">ğŸ—º Mapa</a>
</nav>

<main>
  <section>
    <div id="mapa" style="height:520px; border-radius:12px; box-shadow:0 0 25px rgba(255,217,102,0.2);"></div>

    <div id="statusMape" style="text-align:center; margin-top:10px; font-size:1.1em; color:#ffd966;">
      UÄitavanje...
    </div>

    <div id="panel" style="margin-top:15px; text-align:center; background:rgba(255,255,255,0.07); border-radius:10px; padding:10px;">
      <p>ğŸ“¡ <b>Status drona:</b> <span id="statusDrona">Neaktivan</span></p>
      <p>ğŸŒ¡ Temperatura: <span id="tempPolja">--</span>Â°C | ğŸ’¨ COâ‚‚: <span id="co2Polja">--</span> ppm | ğŸ¦  Aktivnost bakterija: <span id="bact">--</span></p>
      <video id="miniCam" autoplay muted loop width="200" style="border-radius:8px; margin-top:10px;">
        <source src="https://cdn.pixabay.com/video/2022/08/14/128536-745074472_large.mp4" type="video/mp4">
      </video>
    </div>

  </section>
</main>

<footer>
  Â© 2025 | Eko AI GeoHub | Autori: <b>Elvir ÄŒajiÄ‡</b> & <b>Sead NoÄajviÄ‡</b>
</footer>

<script>
// ======== OSNOVNA MAPA ========
const mapa = L.map('mapa').setView([44.53, 18.67], 14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap'
}).addTo(mapa);

// ======== IKONA DRONA ========
const dronIkona = L.icon({
  iconUrl: 'https://cdn-icons-png.flaticon.com/512/326/326545.png',
  iconSize: [40, 40],
  iconAnchor: [20, 20]
});
let marker = L.marker([44.53, 18.67], { icon: dronIkona }).addTo(mapa);

// ======== PUTANJA LETA ========
let trag = [];
let polyline = L.polyline(trag, { color: 'red', weight: 3 }).addTo(mapa);

// ======== ZONA SKENIRANJA ========
let zona = L.circle([44.53, 18.67], {
  color: "#00ff88",
  fillColor: "#00ff88",
  fillOpacity: 0.2,
  radius: 200
}).addTo(mapa);

// ======== GENERISANJE PODATAKA ========
function azurirajPoziciju() {
  // simulacija kretanja drona
  let x = 44.53 + (Math.random() - 0.5) / 300;
  let y = 18.67 + (Math.random() - 0.5) / 300;
  let vrijeme = Date.now();
  localStorage.setItem("dron_pozicija", JSON.stringify({ x, y, vrijeme }));

  marker.setLatLng([x, y]);
  trag.push([x, y]);
  polyline.setLatLngs(trag);
  zona.setLatLng([x, y]);
  mapa.panTo([x, y]);

  // senzorski podaci
  const temp = (16 + Math.random() * 10).toFixed(1);
  const co2 = (380 + Math.random() * 100).toFixed(0);
  const bact = ["Niska", "Normalna", "PoviÅ¡ena", "KritiÄna"][Math.floor(Math.random() * 4)];

  document.getElementById("tempPolja").textContent = temp;
  document.getElementById("co2Polja").textContent = co2;
  document.getElementById("bact").textContent = bact;

  // prikaz statusa
  document.getElementById("statusMape").textContent =
    `ğŸ›°ï¸ Dron na koordinatama: ${x.toFixed(4)}, ${y.toFixed(4)} | ${new Date(vrijeme).toLocaleTimeString()}`;

  // promjena boje zone po bakterijama
  if (bact === "KritiÄna") zona.setStyle({ color: "#ff0000", fillColor: "#ff0000" });
  else if (bact === "PoviÅ¡ena") zona.setStyle({ color: "#ffff00", fillColor: "#ffff00" });
  else zona.setStyle({ color: "#00ff88", fillColor: "#00ff88" });

  // promjena statusa
  document.getElementById("statusDrona").textContent = "U letu i skenira sektor B3";

  // glasovni izvjeÅ¡taj svakih 15 sekundi
  if (!window.zadnjiGlas || Date.now() - window.zadnjiGlas > 15000) {
    govoriAI(`Dron je na koordinatama ${x.toFixed(3)}, ${y.toFixed(3)}. Temperatura ${temp} stepeni, CO2 ${co2} ppm. Aktivnost bakterija: ${bact}.`);
    window.zadnjiGlas = Date.now();
  }
}

// ======== GLASOVNA FUNKCIJA ========
function govoriAI(tekst) {
  const glas = new SpeechSynthesisUtterance(tekst + " Potpisuje Elvir AI GeoHub nadzor.");
  glas.lang = "bs-BA";
  glas.pitch = 0.9;
  glas.rate = 0.95;
  glas.volume = 1;
  speechSynthesis.speak(glas);
}

// ======== ANIMACIJA PULSIRANJA ZONE ========
setInterval(() => {
  let current = zona.getRadius();
  let nova = current === 200 ? 220 : 200;
  zona.setRadius(nova);
}, 1000);

// ======== PERIODIÄŒNO AÅ½URIRANJE ========
setInterval(azurirajPoziciju, 5000);
azurirajPoziciju();

</script>

</body>
</html>
